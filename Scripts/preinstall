#!/bin/sh

set -eu

PASSWORD="$(uuidgen)"
if ! grep -q "^export PASSWORD=" ./config.sh; then
    echo "export PASSWORD=\"$PASSWORD\"" >> ./config.sh
fi

# shellcheck disable=SC1091
. ./config.sh

install_logfile="/tmp/immich-install.log"
./createlog.sh "$install_logfile"
{
    ./installdependencies.sh
    ./configurepostgres.sh "$PASSWORD"
} 2>&1 | tee -a "$install_logfile"
